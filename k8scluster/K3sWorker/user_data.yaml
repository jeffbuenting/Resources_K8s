#cloud-config

# https://computingforgeeks.com/install-kubernetes-on-ubuntu-using-k3s/
# https://kb.vmware.com/s/article/82250

# Upgrade the instance on first boot
package_update: true
package_upgrade: true

users:
  - default
  - name: ${adminuser}
    # this is the password hash generated by mkpasswd --method=SHA-512 --rounds=4096
    passwd: "${adminpassword}"
    sudo: ALL=(ALL) ALL
    groups: users, sudo
    lock_passwd: false
    ssh_authorized_keys:
      - ${ssh_rsa_key}

packages:
  - apt-transport-https 
  - ca-certificates 
  - curl 
  - software-properties-common

runcmd:
  - curl -sfL http://get.k3s.io | K3S_URL=https://${k3smasternodeip}:6443 K3S_TOKEN=${token} sh -s server -
  
  